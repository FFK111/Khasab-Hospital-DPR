<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MOH Khasab Hospital Daily Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        :root {
            --primary-color: #005f73;
            --secondary-color: #0a9396;
            --background-gradient: linear-gradient(to top, #e0eafc 0%, #cfdef3 100%);
            --card-shadow: 0 4px 15px rgba(0,0,0,0.08);
            --card-hover-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        body {
            background: var(--background-gradient);
            min-height: 100vh;
            padding: 10px;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: manipulation;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .header {
            background: linear-gradient(90deg, #005f73, #0a9396);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            text-align: center;
            position: relative;
        }
        .header h1 { font-weight: 600; }

        .language-switch { position: absolute; top: 20px; right: 20px; z-index: 100; }

        .card {
            border-radius: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            border: none;
            transition: all 0.3s ease-in-out;
            animation: fadeIn 0.6s ease-out forwards;
        }
        .card:hover { transform: translateY(-5px); box-shadow: var(--card-hover-shadow); }

        .card-header {
            background: linear-gradient(90deg, #1a2a6c, #2c3e50);
            color: white;
            border-radius: 20px 20px 0 0 !important;
            font-weight: 600;
            padding: 15px 25px;
            border-bottom: 0;
        }
        .btn {
            border-radius: 12px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-success { background: linear-gradient(90deg, #27ae60, #2ecc71); border:none; }
        .btn-info { background: linear-gradient(90deg, #3498db, #2980b9); border:none; }
        
        .form-control, .form-select {
            border-radius: 12px;
            border: 1px solid #e1e5eb;
            padding: 12px;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(10, 147, 150, 0.2);
        }
        .work-item {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid var(--secondary-color);
        }
        .footer {
            background: #2c3e50;
            color: white;
            border-radius: 20px;
            padding: 20px;
            margin-top: 30px;
            text-align: center;
        }
        .whatsapp-preview {
            background: #25D366;
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
            display: none;
        }
        .whatsapp-preview h3 {
            border-bottom: 2px dashed rgba(255,255,255,0.5);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .detail-options { background: #f0f4f8; border-radius: 12px; padding: 15px; margin-top: 10px; }
        .remark-item { background: #fff3cd; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #ffc107; }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: rgba(0,0,0,0.1);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-family: 'Poppins', 'Segoe UI', sans-serif;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .copy-notification {
            position: fixed; top: 20px; right: 20px;
            background: var(--secondary-color);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            font-weight: 600;
        }

        .quantity-section-container { display: none; }
        .quantity-section { background: #ffffff; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .floor-quantity-row { background: #f8f9fa; border-radius: 12px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #3a7bd5; }
        
        .nav-tabs .nav-link { color: var(--primary-color); font-weight: 600; border-radius: 12px 12px 0 0; }
        .nav-tabs .nav-link.active { color: #000; background-color: #fff; border-color: #dee2e6 #dee2e6 #fff; }
        .tab-content { background: #fff; border: 1px solid #dee2e6; border-top: 0; }

        .sub-option-qty { display: none; width: 120px; margin-top: 5px; }

        @media (max-width: 768px) { body { padding: 5px; } .header { padding: 20px; } .language-switch { position: static; margin: 15px auto; width: 120px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-hospital-user me-3"></i><span data-translation-key="hospitalTitle">MOH Khasab Hospital</span></h1>
            <p class="lead" data-translation-key="systemTitle">Daily Work Report System</p>
            <div class="language-switch">
                <select class="form-select" id="languageSelect" style="width: 150px;">
                    <option value="en">English</option> <option value="ur">ÿßÿ±ÿØŸà</option> <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                </select>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3 class="mb-0"><i class="fas fa-info-circle me-3"></i><span data-translation-key="reportDetailsTitle">Report Details</span></h3>
            </div>
            <div class="card-body p-4">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label fw-bold" data-translation-key="dateLabel"><i class="fas fa-calendar-alt me-2"></i>Date</label>
                        <input type="date" class="form-control" id="reportDate">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold" data-translation-key="teamNameLabel"><i class="fas fa-users me-2"></i>Team Name</label>
                        <select class="form-select" id="teamName" multiple size="5">
                            <option value="Zeeshan" data-translation-key="zeeshanOption">Zeeshan</option>
                            <option value="Abdur Raheem" data-translation-key="abdurRaheemOption">Abdur Raheem</option>
                            <option value="Akbar Ali" data-translation-key="akbarAliOption">Akbar Ali</option>
                            <option value="Riyazul" data-translation-key="riyazulOption">Riyazul</option>
                            <option value="Anas" data-translation-key="anasOption">Anas</option>
                            <option value="other" data-translation-key="otherTeamOption">Other Name</option>
                        </select>
                        <div id="otherTeamMemberContainer" style="display: none;" class="mt-2">
                            <input type="text" class="form-control" id="otherTeamMember" data-translation-key="otherTeamPlaceholder" placeholder="Enter team member name">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold" data-translation-key="totalManpowerLabel"><i class="fas fa-helmet-safety me-2"></i>Total Manpower Today</label>
                        <input type="number" class="form-control" id="totalManpower" data-translation-key="manpowerPlaceholder" placeholder="e.g., 5">
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><h3 class="mb-0"><i class="fas fa-tasks me-3"></i><span data-translation-key="locationAndWorkTitle">Location & Work Details</span></h3></div>
            <div class="card-body p-4">
                <div class="mb-4">
                    <p class="fw-bold" data-translation-key="selectFloorsLabel"><i class="fas fa-layer-group me-2"></i>1. Select Floors to Add Work Tabs</p>
                    <div class="row">
                        <div class="col-md-3 col-6"><div class="form-check"><input class="form-check-input floor-checkbox" type="checkbox" value="Level 00" id="floorL00"><label class="form-check-label" for="floorL00" data-translation-key="level00Label">Level 00</label></div></div>
                        <div class="col-md-3 col-6"><div class="form-check"><input class="form-check-input floor-checkbox" type="checkbox" value="Level 01" id="floorL01"><label class="form-check-label" for="floorL01" data-translation-key="level01Label">Level 01</label></div></div>
                        <div class="col-md-3 col-6"><div class="form-check"><input class="form-check-input floor-checkbox" type="checkbox" value="Level 02" id="floorL02"><label class="form-check-label" for="floorL02" data-translation-key="level02Label">Level 02</label></div></div>
                        <div class="col-md-3 col-6"><div class="form-check"><input class="form-check-input floor-checkbox" type="checkbox" value="Level 03" id="floorL03"><label class="form-check-label" for="floorL03" data-translation-key="level03Label">Level 03</label></div></div>
                    </div>
                </div>
                <hr>
                <div id="floorTabsContainer">
                    <ul class="nav nav-tabs" id="floorTabs" role="tablist"></ul>
                    <div class="tab-content" id="floorTabsContent"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><h3 class="mb-0"><i class="fas fa-chart-line me-3"></i><span data-translation-key="quantityTitle">Completed Qty / Total Qty</span></h3></div>
            <div class="card-body p-4">
                <div class="form-check form-switch mb-4">
                    <input class="form-check-input" type="checkbox" role="switch" id="includeQuantitySwitch">
                    <label class="form-check-label" for="includeQuantitySwitch" data-translation-key="includeQuantityLabel">Include "Completed Qty / Total Qty" in the report</label>
                </div>
                <div class="quantity-section-container" id="quantitySectionContainer">
                    <div class="quantity-section">
                        <h4 data-translation-key="accessControlTitle" class="mb-3"><i class="fas fa-network-wired me-2"></i>Access control cable pulling</h4>
                        <div id="accessControlQuantities">
                             <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="groundFloorLabel">1. Ground floor</label></div><div class="col-md-3"><input type="number" class="form-control" id="groundFloorComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 160</label></div></div>
                            <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="firstFloorLabel">2. First floor</label></div><div class="col-md-3"><input type="number" class="form-control" id="firstFloorComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 136</label></div></div>
                            <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="secondFloorLabel">3. Second floor</label></div><div class="col-md-3"><input type="number" class="form-control" id="secondFloorComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 102</label></div></div>
                        </div>
                    </div>
                    <div class="quantity-section">
                        <h4 data-translation-key="acpPanelTitle" class="mb-3"><i class="fas fa-th me-2"></i>Total ACP panel installation</h4>
                        <div id="acpPanelQuantities">
                            <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="acpGroundFloorLabel">1. Ground floor</label></div><div class="col-md-3"><input type="number" class="form-control" id="acpGroundFloorComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 57</label></div></div>
                            <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="acpFirstFloorLabel">2. First floor</label></div><div class="col-md-3"><input type="number" class="form-control" id="acpFirstFloorComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 43</label></div></div>
                            <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="acpSecondFloorLabel">3. Second floor</label></div><div class="col-md-3"><input type="number" class="form-control" id="acpSecondFloorComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 37</label></div></div>
                             <div class="floor-quantity-row row align-items-center"><div class="col-md-6"><label class="form-label fw-bold mb-0" data-translation-key="liftLabel">4. Lift</label></div><div class="col-md-3"><input type="number" class="form-control" id="liftComplete" placeholder="Complete Qty"></div><div class="col-md-3"><label class="form-label fw-bold mb-0">/ 10</label></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header"><h3 class="mb-0"><i class="fas fa-exclamation-circle me-3"></i><span data-translation-key="remarksTitle">Remarks & Issues</span></h3></div>
            <div class="card-body p-4">
                <div id="remarkContainer"></div>
                <div class="text-center mt-3"><button class="btn btn-info" id="addRemarkBtn"><i class="fas fa-plus me-2"></i><span data-translation-key="addRemarkButton">Add Remark</span></button></div>
            </div>
        </div>

        <div class="text-center my-4"><button class="btn btn-success btn-lg" id="generateBtn"><i class="fas fa-paper-plane me-2"></i><span data-translation-key="generateReportButton">Generate Report</span></button></div>

        <div class="whatsapp-preview" id="previewSection">
            <h3><i class="fab fa-whatsapp me-2"></i><span data-translation-key="reportPreviewTitle">Report Preview</span></h3>
            <pre id="messagePreview"></pre>
            <div class="text-center mt-4"><button class="btn btn-light" id="copyBtn"><i class="fas fa-copy me-2"></i><span data-translation-key="copyMessageButton">Copy Message</span></button></div>
        </div>

        <div class="footer"><p class="mb-0">&copy; 2025 <span data-translation-key="hospitalFooter">MOH Khasab Hospital Report System</span> | <span data-translation-key="developerFooter">Developed by MSTE</span></p></div>
    </div>

    <div class="copy-notification" id="copyNotification"><i class="fas fa-check-circle me-2"></i><span data-translation-key="messageCopiedText">Message copied successfully!</span></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('reportDate').valueAsDate = new Date();
        let remarkCount = 0;
        
        const translations = {
            en: { hospitalTitle: "MOH Khasab Hospital", systemTitle: "Daily Work Report System", reportDetailsTitle: "Report Details", dateLabel: "Date", teamNameLabel: "Team Name", zeeshanOption: "Zeeshan", abdurRaheemOption: "Abdur Raheem", akbarAliOption: "Akbar Ali", riyazulOption: "Riyazul", anasOption: "Anas", otherTeamOption: "Other Name", otherTeamPlaceholder: "Enter team member name", totalManpowerLabel: "Total Manpower Today", manpowerPlaceholder: "e.g., 5", locationAndWorkTitle: "Location & Work Details", selectFloorsLabel: "1. Select Floors to Add Work Tabs", level00Label: "Level 00", level01Label: "Level 01", level02Label: "Level 02", level03Label: "Level 03", selectZonesLabel: "2. Select Zones for", quantityTitle: "Completed Qty / Total Qty", includeQuantityLabel: "Include \"Completed Qty / Total Qty\" in the report", accessControlTitle: "Access control cable pulling", groundFloorLabel: "1. Ground floor", firstFloorLabel: "2. First floor", secondFloorLabel: "3. Second floor", acpPanelTitle: "Total ACP panel installation", acpGroundFloorLabel: "1. Ground floor", acpFirstFloorLabel: "2. First floor", acpSecondFloorLabel: "3. Second floor", liftLabel: "4. Lift", remarksTitle: "Remarks & Issues", addRemarkButton: "Add Remark", generateReportButton: "Generate Report", reportPreviewTitle: "Report Preview", copyMessageButton: "Copy Message", messageCopiedText: "Message copied successfully!", hospitalFooter: "MOH Khasab Hospital Report System", developerFooter: "Developed by MSTE", qtyPlaceholder: "Qty" },
            ur: { hospitalTitle: "ÿß€åŸÖ ÿßŸà ÿß€å⁄Ü ÿÆÿµÿ® €Åÿ≥Ÿæÿ™ÿßŸÑ", systemTitle: "ÿØŸÜ ⁄©€å ÿ±ŸæŸàÿ±Ÿπ ⁄©ÿß ŸÜÿ∏ÿßŸÖ", reportDetailsTitle: "ÿ±ŸæŸàÿ±Ÿπ ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™", dateLabel: "ÿ™ÿßÿ±€åÿÆ", teamNameLabel: "Ÿπ€åŸÖ ⁄©ÿß ŸÜÿßŸÖ", zeeshanOption: "ÿ≤€åÿ¥ÿßŸÜ", abdurRaheemOption: "ÿπÿ®ÿØÿßŸÑÿ±ÿ≠€åŸÖ", akbarAliOption: "ÿß⁄©ÿ®ÿ± ÿπŸÑ€å", riyazulOption: "ÿ±€åÿßÿ∂ ÿßŸÑÿπŸÑ€å", anasOption: "ÿßŸÜÿ≥", otherTeamOption: "ÿØŸàÿ≥ÿ±ÿß ŸÜÿßŸÖ", otherTeamPlaceholder: "Ÿπ€åŸÖ ŸÖŸÖÿ®ÿ± ⁄©ÿß ŸÜÿßŸÖ ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫", totalManpowerLabel: "ÿ¢ÿ¨ ⁄©€å ⁄©ŸÑ ÿßŸÅÿ±ÿßÿØ€å ŸÇŸàÿ™", manpowerPlaceholder: "ŸÖÿ´ŸÑÿßŸã 5", locationAndWorkTitle: "ŸÖŸÇÿßŸÖ ÿßŸàÿ± ⁄©ÿßŸÖ ⁄©€å ÿ™ŸÅÿµ€åŸÑÿßÿ™", selectFloorsLabel: "1. ⁄©ÿßŸÖ ⁄©€í Ÿπ€åÿ®ÿ≤ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±ŸÜ€í ⁄©€í ŸÑ€å€í ŸÖŸÜÿ≤ŸÑ€å⁄∫ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫€î", level00Label: "ÿ≥ÿ∑ÿ≠ 00", level01Label: "ÿ≥ÿ∑ÿ≠ 01", level02Label: "ÿ≥ÿ∑ÿ≠ 02", level03Label: "ÿ≥ÿ∑ÿ≠ 03", selectZonesLabel: "2. ⁄©€í ŸÑ€å€í ÿ≤ŸàŸÜÿ≤ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫€î", quantityTitle: "ŸÖ⁄©ŸÖŸÑ ⁄©€å ⁄Øÿ¶€å ŸÖŸÇÿØÿßÿ± / ⁄©ŸÑ ŸÖŸÇÿØÿßÿ±", includeQuantityLabel: "ÿ±ŸæŸàÿ±Ÿπ ŸÖ€å⁄∫ \"ŸÖ⁄©ŸÖŸÑ ÿ¥ÿØ€Å ŸÖŸÇÿØÿßÿ± / ⁄©ŸÑ ŸÖŸÇÿØÿßÿ±\" ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫€î", accessControlTitle: "ÿß€å⁄©ÿ≥ÿ≥ ⁄©ŸÜŸπÿ±ŸàŸÑ ⁄©€åÿ®ŸÑ ⁄©ÿ¥€å", groundFloorLabel: "1. ⁄Øÿ±ÿßÿ§ŸÜ⁄à ŸÅŸÑŸàÿ±", firstFloorLabel: "2. Ÿæ€ÅŸÑÿß ŸÖŸÜÿ≤ŸÑ", secondFloorLabel: "3. ÿØŸàÿ≥ÿ±ÿß ŸÖŸÜÿ≤ŸÑ", acpPanelTitle: "⁄©ŸÑ ÿß€í ÿ≥€å Ÿæ€å Ÿæ€åŸÜŸÑ ⁄©€å ÿ™ŸÜÿµ€åÿ®", acpGroundFloorLabel: "1. ⁄Øÿ±ÿßÿ§ŸÜ⁄à ŸÅŸÑŸàÿ±", acpFirstFloorLabel: "2. Ÿæ€ÅŸÑÿß ŸÖŸÜÿ≤ŸÑ", acpSecondFloorLabel: "3. ÿØŸàÿ≥ÿ±ÿß ŸÖŸÜÿ≤ŸÑ", liftLabel: "4. ŸÑŸêŸÅÿ™", remarksTitle: "ÿ™ÿ®ÿµÿ±€í ÿßŸàÿ± ŸÖÿ≥ÿßÿ¶ŸÑ", addRemarkButton: "ÿ™ÿ®ÿµÿ±€Å ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫", generateReportButton: "ÿ±ŸæŸàÿ±Ÿπ ÿ™€åÿßÿ± ⁄©ÿ±€å⁄∫", reportPreviewTitle: "ÿ±ŸæŸàÿ±Ÿπ ⁄©ÿß Ÿæ€åÿ¥ ŸÜÿ∏ÿßÿ±€Å", copyMessageButton: "Ÿæ€åÿ∫ÿßŸÖ ⁄©ÿßŸæ€å ⁄©ÿ±€å⁄∫", messageCopiedText: "Ÿæ€åÿ∫ÿßŸÖ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ⁄©ÿßŸæ€å €ÅŸà ⁄Ø€åÿß!", hospitalFooter: "ÿß€åŸÖ ÿßŸà ÿß€å⁄Ü ÿÆÿµÿ® €Åÿ≥Ÿæÿ™ÿßŸÑ ÿ±ŸæŸàÿ±Ÿπ ⁄©ÿß ŸÜÿ∏ÿßŸÖ", developerFooter: "MSTE ⁄©€í ÿ≤ÿ±€åÿπ€í ÿ™€åÿßÿ± ⁄©ÿ±ÿØ€Å", qtyPlaceholder: "ŸÖŸÇÿØÿßÿ±" },
            bn: { hospitalTitle: "‡¶è‡¶Æ‡¶ì‡¶è‡¶á‡¶ö ‡¶ñ‡¶∏‡¶æ‡¶¨ ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤", systemTitle: "‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ", reportDetailsTitle: "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£", dateLabel: "‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ", teamNameLabel: "‡¶¶‡¶≤‡ßá‡¶∞ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø", zeeshanOption: "‡¶ú‡¶ø‡¶∂‡¶æ‡¶®", abdurRaheemOption: "‡¶Ü‡¶¨‡¶¶‡ßÅ‡¶∞ ‡¶∞‡¶π‡¶ø‡¶Æ", akbarAliOption: "‡¶Ü‡¶ï‡¶¨‡¶∞ ‡¶Ü‡¶≤‡ßÄ", riyazulOption: "‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶ú‡ßÅ‡¶≤", anasOption: "‡¶Ü‡¶®‡¶æ‡¶∏", otherTeamOption: "‡¶Ö‡¶®‡ßç‡¶Ø ‡¶®‡¶æ‡¶Æ", otherTeamPlaceholder: "‡¶¶‡¶≤‡ßá‡¶∞ ‡¶∏‡¶¶‡¶∏‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", totalManpowerLabel: "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶ú‡¶®‡¶∂‡¶ï‡ßç‡¶§‡¶ø", manpowerPlaceholder: "‡¶Ø‡ßá‡¶Æ‡¶®, 5", locationAndWorkTitle: "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£", selectFloorsLabel: "1. ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶§‡¶≤‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", level00Label: "‡¶∏‡ßç‡¶§‡¶∞ 00", level01Label: "‡¶∏‡ßç‡¶§‡¶∞ 01", level02Label: "‡¶∏‡ßç‡¶§‡¶∞ 02", level03Label: "‡¶∏‡ßç‡¶§‡¶∞ 03", selectZonesLabel: "2. ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶û‡ßç‡¶ö‡¶≤ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", quantityTitle: "‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ / ‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£", includeQuantityLabel: "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá \"‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ / ‡¶Æ‡ßã‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£\" ‡¶Ö‡¶®‡ßç‡¶§‡¶∞‡ßç‡¶≠‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®", accessControlTitle: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶¨‡¶≤ ‡¶ü‡¶æ‡¶®‡¶æ", groundFloorLabel: "1. ‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶´‡ßç‡¶≤‡ßã‡¶∞", firstFloorLabel: "2. ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶§‡¶≤‡¶æ", secondFloorLabel: "3. ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶§‡¶≤‡¶æ", acpPanelTitle: "‡¶Æ‡ßã‡¶ü ‡¶è‡¶∏‡¶ø‡¶™‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤‡ßá‡¶∂‡¶®", acpGroundFloorLabel: "1. ‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶´‡ßç‡¶≤‡ßã‡¶∞", acpFirstFloorLabel: "2. ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶§‡¶≤‡¶æ", acpSecondFloorLabel: "3. ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶§‡¶≤‡¶æ", liftLabel: "4. ‡¶≤‡¶ø‡¶´‡¶ü", remarksTitle: "‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ", addRemarkButton: "‡¶Æ‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®", generateReportButton: "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®", reportPreviewTitle: "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â", copyMessageButton: "‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®", messageCopiedText: "‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", hospitalFooter: "‡¶è‡¶Æ‡¶ì‡¶è‡¶á‡¶ö ‡¶ñ‡¶∏‡¶æ‡¶¨ ‡¶π‡¶æ‡¶∏‡¶™‡¶æ‡¶§‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ", developerFooter: "MSTE ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶°‡ßá‡¶≠‡ßá‡¶≤‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá", qtyPlaceholder: "‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" }
        };
        const workTypeTranslations = {
            en: { cablePulling: "Cable pulling", acpPanelInstallation: "ACP panel installation", acpPanelTermination: "ACP Panel termination", speakerInstallation: "Speaker installation", inductionLoopInstallation: "Induction loop installation", tvInstallation: "TV installation", cctv: "CCTV", otherWork: "Other Work", singleDoor: "Single door", doubleDoor: "Double door", panicButton: "Panic button", corridor: "Corridor", avRoomDm: "AV room DM", avSpeaker: "AV speaker", tableCounterLoop: "Table counter loop", ceiling: "Ceiling", box: "Box", horn: "Horn" },
            ur: { cablePulling: "⁄©€åÿ®ŸÑ ⁄©ÿ¥€å", acpPanelInstallation: "ÿß€å ÿ≥€å Ÿæ€å Ÿæ€åŸÜŸÑ ⁄©€å ÿ™ŸÜÿµ€åÿ®", acpPanelTermination: "ÿß€å ÿ≥€å Ÿæ€å Ÿæ€åŸÜŸÑ ⁄©ÿß ÿßÿÆÿ™ÿ™ÿßŸÖ", speakerInstallation: "ÿßÿ≥Ÿæ€å⁄©ÿ± ⁄©€å ÿ™ŸÜÿµ€åÿ®", inductionLoopInstallation: "ÿßŸÜ⁄à⁄©ÿ¥ŸÜ ŸÑŸàŸæ ⁄©€å ÿ™ŸÜÿµ€åÿ®", tvInstallation: "Ÿπ€å Ÿà€å ⁄©€å ÿ™ŸÜÿµ€åÿ®", cctv: "ÿ≥€å ÿ≥€å Ÿπ€å Ÿà€å", otherWork: "ÿØ€å⁄Øÿ± ⁄©ÿßŸÖ", singleDoor: "ÿ≥ŸÜ⁄ØŸÑ ÿØÿ±Ÿàÿßÿ≤€Å", doubleDoor: "⁄àÿ®ŸÑ ÿØÿ±Ÿàÿßÿ≤€Å", panicButton: "Ÿæ€åŸÜ⁄© ÿ®ŸπŸÜ", corridor: "⁄©Ÿàÿ±€å⁄àŸàÿ±", avRoomDm: "ÿß€í Ÿà€å ÿ±ŸàŸÖ ⁄à€å ÿß€åŸÖ", avSpeaker: "ÿß€í Ÿà€å ÿßÿ≥Ÿæ€å⁄©ÿ±", tableCounterLoop: "Ÿπ€åÿ®ŸÑ ⁄©ÿßÿ§ŸÜŸπÿ± ŸÑŸàŸæ", ceiling: "⁄Ü⁄æÿ™", box: "ÿ®ÿß⁄©ÿ≥", horn: "€Åÿßÿ±ŸÜ" },
            bn: { cablePulling: "‡¶ï‡ßá‡¶¨‡¶≤ ‡¶ü‡¶æ‡¶®‡¶æ", acpPanelInstallation: "‡¶è‡¶∏‡¶ø‡¶™‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤‡ßá‡¶∂‡¶®", acpPanelTermination: "‡¶è‡¶∏‡¶ø‡¶™‡¶ø ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶Æ‡¶æ‡¶™‡ßç‡¶§‡¶ø", speakerInstallation: "‡¶∏‡ßç‡¶™‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤‡ßá‡¶∂‡¶®", inductionLoopInstallation: "‡¶á‡¶®‡¶°‡¶æ‡¶ï‡¶∂‡¶® ‡¶≤‡ßÅ‡¶™ ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤‡ßá‡¶∂‡¶®", tvInstallation: "‡¶ü‡¶ø‡¶≠‡¶ø ‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶≤‡ßá‡¶∂‡¶®", cctv: "‡¶∏‡¶ø‡¶∏‡¶ø‡¶ü‡¶ø‡¶≠‡¶ø", otherWork: "‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú", singleDoor: "‡¶è‡¶ï‡¶ï ‡¶¶‡¶∞‡¶ú‡¶æ", doubleDoor: "‡¶°‡¶æ‡¶¨‡¶≤ ‡¶¶‡¶∞‡¶ú‡¶æ", panicButton: "‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶ï ‡¶¨‡¶æ‡¶ü‡¶®", corridor: "‡¶ï‡¶∞‡¶ø‡¶°‡ßã‡¶∞", avRoomDm: "‡¶è‡¶≠‡¶ø ‡¶∞‡ßÅ‡¶Æ ‡¶°‡¶ø‡¶è‡¶Æ", avSpeaker: "‡¶è‡¶≠‡¶ø ‡¶∏‡ßç‡¶™‡¶ø‡¶ï‡¶æ‡¶∞", tableCounterLoop: "‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡ßÅ‡¶™", ceiling: "‡¶õ‡¶æ‡¶¶", box: "‡¶¨‡¶æ‡¶ï‡ßç‡¶∏", horn: "‡¶π‡¶∞‡ßç‡¶®" }
        };

        function translateUI(language) {
            document.querySelectorAll('[data-translation-key]').forEach(el => {
                const key = el.dataset.translationKey;
                if (translations[language][key]) {
                    if (el.placeholder !== undefined) {
                        el.placeholder = translations[language][key];
                    } else {
                        el.textContent = translations[language][key];
                    }
                }
            });

            document.querySelectorAll('.zone-select-label').forEach(label => {
                const floorValue = label.dataset.floor;
                label.innerHTML = `<i class="fas fa-map-signs me-2"></i>${translations[language].selectZonesLabel} ${floorValue}:`;
            });
            
            document.querySelectorAll('.work-type-checkbox').forEach(el => {
                const key = el.dataset.workTypeKey;
                if (workTypeTranslations[language][key]) {
                    el.nextElementSibling.textContent = workTypeTranslations[language][key];
                }
            });

            document.querySelectorAll('.sub-option-checkbox').forEach(el => {
                const key = el.dataset.subOptionKey;
                if (workTypeTranslations[language][key]) {
                    el.nextElementSibling.textContent = workTypeTranslations[language][key];
                }
            });

            document.querySelectorAll('input[placeholder="Qty"]').forEach(input => {
                input.placeholder = translations[language].qtyPlaceholder || "Qty";
            });
        }
        
        document.getElementById('languageSelect').addEventListener('change', function() { translateUI(this.value); });
        
        document.getElementById('teamName').addEventListener('change', function() {
            const otherSelected = Array.from(this.selectedOptions).some(option => option.value === 'other');
            document.getElementById('otherTeamMemberContainer').style.display = otherSelected ? 'block' : 'none';
            if (!otherSelected) document.getElementById('otherTeamMember').value = '';
        });
        
        document.getElementById('includeQuantitySwitch').addEventListener('change', function() {
            document.getElementById('quantitySectionContainer').style.display = this.checked ? 'block' : 'none';
        });

        document.querySelectorAll('.floor-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) { addFloorTab(this.value); } else { removeFloorTab(this.value); }
            });
        });

        function addFloorTab(floorValue) {
            const sanitizedFloorValue = floorValue.replace(/\s+/g, '-');
            const language = document.getElementById('languageSelect').value;

            const tab = document.createElement('li');
            tab.className = 'nav-item';
            tab.innerHTML = `<button class="nav-link" id="tab-${sanitizedFloorValue}" data-bs-toggle="tab" data-bs-target="#pane-${sanitizedFloorValue}" type="button">${floorValue}</button>`;
            document.getElementById('floorTabs').appendChild(tab);

            const pane = document.createElement('div');
            pane.className = 'tab-pane fade p-3';
            pane.id = `pane-${sanitizedFloorValue}`;
            pane.dataset.floor = floorValue;
            
            const zoneSelectId = `zone-select-${sanitizedFloorValue}`;
            pane.innerHTML = `
                <div class="mb-3">
                    <label class="form-label fw-bold zone-select-label" data-floor="${floorValue}" for="${zoneSelectId}"><i class="fas fa-map-signs me-2"></i>${translations[language].selectZonesLabel} ${floorValue}:</label>
                    <select class="form-select" id="${zoneSelectId}" multiple size="4">
                        <option value="Zone 01">Zone 01</option> <option value="Zone 02">Zone 02</option> <option value="Zone 03">Zone 03</option> <option value="Zone 04">Zone 04</option> <option value="Zone 05">Zone 05</option> <option value="Zone 06">Zone 06</option> <option value="Zone 07">Zone 07</option> <option value="Zone 08">Zone 08</option>
                    </select>
                </div>
                <div class="work-items-container" id="work-items-${sanitizedFloorValue}"></div>`;
            document.getElementById('floorTabsContent').appendChild(pane);
            
            document.getElementById(zoneSelectId).addEventListener('change', (e) => updateWorkItemsForFloor(floorValue, e.target));

            if (document.querySelectorAll('#floorTabs .nav-link').length === 1) { new bootstrap.Tab(tab.querySelector('button')).show(); }
        }

        function removeFloorTab(floorValue) {
            const sanitizedFloorValue = floorValue.replace(/\s+/g, '-');
            const tabButton = document.getElementById(`tab-${sanitizedFloorValue}`);
            const pane = document.getElementById(`pane-${sanitizedFloorValue}`);
            if (tabButton) tabButton.parentElement.remove();
            if (pane) pane.remove();
            const firstTab = document.querySelector('#floorTabs .nav-link');
            if (firstTab) { new bootstrap.Tab(firstTab).show(); }
        }
        
        function updateWorkItemsForFloor(floorValue, zoneSelectElement) {
            const workContainer = document.getElementById(`work-items-${floorValue.replace(/\s+/g, '-')}`);
            const selectedZones = Array.from(zoneSelectElement.selectedOptions).map(opt => opt.value);
            workContainer.querySelectorAll('.work-item').forEach(item => {
                if (!selectedZones.includes(item.dataset.location.split(' - ')[1])) { item.remove(); }
            });
            selectedZones.forEach(zone => {
                const location = `${floorValue} - ${zone}`;
                if (!document.getElementById(`workItem-${location.replace(/\s+/g, '-')}`)) {
                    createWorkItem(location, workContainer);
                }
            });
        }

        function createWorkItem(location, container) {
            const sanitizedLocation = location.replace(/\s+/g, '-');
            const language = document.getElementById('languageSelect').value;
            const workItemEl = document.createElement('div');
            workItemEl.className = 'work-item mb-3';
            workItemEl.id = `workItem-${sanitizedLocation}`;
            workItemEl.dataset.location = location;

            let checkboxesHTML = '';
            Object.keys(workTypeTranslations.en).forEach(key => {
                 if(!['singleDoor', 'doubleDoor', 'panicButton', 'corridor', 'avRoomDm', 'avSpeaker', 'tableCounterLoop', 'ceiling', 'box', 'horn'].includes(key)) {
                    checkboxesHTML += `<div class="form-check form-check-inline work-type-checkbox-wrapper"><input class="form-check-input work-type-checkbox" data-work-type-key="${key}" type="checkbox" value="${workTypeTranslations.en[key]}" id="${key}-${sanitizedLocation}"><label class="form-check-label" for="${key}-${sanitizedLocation}">${workTypeTranslations[language][key]}</label></div>`;
                 }
            });
            
            workItemEl.innerHTML = `<h5 class="mb-3"><i class="fas fa-map-marker-alt me-2"></i>${location}</h5><div class="mb-3">${checkboxesHTML}</div><div class="work-details-container" id="workDetailsContainer-${sanitizedLocation}"></div>`;
            container.appendChild(workItemEl);
            
            workItemEl.querySelectorAll('.work-type-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', () => updateWorkDetails(sanitizedLocation, checkbox.value, checkbox.checked));
            });
        }
        
        function updateWorkDetails(sanitizedLocation, workType, isChecked) {
            const workDetailsContainer = document.getElementById(`workDetailsContainer-${sanitizedLocation}`);
            const detailId = `${sanitizedLocation}-${workType.replace(/\s+/g, '-')}`;
            const language = document.getElementById('languageSelect').value;
            const sectionToRemove = document.getElementById(`detailSection-${detailId}`);
            if (sectionToRemove) sectionToRemove.remove();

            if (isChecked) {
                const detailSection = document.createElement('div');
                detailSection.className = 'mb-3 p-3 border rounded detail-section';
                detailSection.id = `detailSection-${detailId}`;

                const workTypeKey = Object.keys(workTypeTranslations.en).find(key => workTypeTranslations.en[key] === workType);
                const workTypeName = workTypeTranslations[language][workTypeKey] || workType;

                let optionsHTML = '';
                const complexTypes = {
                    "Cable pulling": ['singleDoor', 'doubleDoor', 'panicButton', 'corridor', 'avRoomDm', 'avSpeaker', 'tableCounterLoop'],
                    "Speaker installation": ['ceiling', 'box', 'horn']
                };

                if (complexTypes[workType]) {
                    complexTypes[workType].forEach(optKey => {
                        optionsHTML += `<div class="form-check mb-2"><input class="form-check-input sub-option-checkbox" data-sub-option-key="${optKey}" type="checkbox" value="${workTypeTranslations.en[optKey]}" id="chk-${detailId}-${optKey}" onchange="toggleSubOptionQtyField('${detailId}', '${optKey}')"><label class="form-check-label" for="chk-${detailId}-${optKey}">${workTypeTranslations[language][optKey]}</label><input type="number" class="form-control form-control-sm sub-option-qty" id="qty-${detailId}-${optKey}" placeholder="${translations[language].qtyPlaceholder}"></div>`;
                    });
                } else if (workType === 'Other Work') {
                     optionsHTML = `<div class="mt-2"><input type="text" class="form-control mb-2 otherWorkInput" id="otherWorkType-${detailId}" placeholder="${translations[language].otherTeamPlaceholder}"><input type="number" class="form-control qtyField" id="otherWorkQty-${detailId}" placeholder="${translations[language].qtyPlaceholder}"></div>`;
                } else {
                     optionsHTML = `<div class="mt-2"><input type="number" class="form-control qtyField" id="detailQty-${detailId}" placeholder="${translations[language].qtyPlaceholder}"></div>`;
                }
                
                detailSection.innerHTML = `<h6>${workTypeName}</h6><div class="detail-options">${optionsHTML}</div>`;
                workDetailsContainer.appendChild(detailSection);
            }
        }

        function toggleSubOptionQtyField(detailId, optionKey) {
            const chk = document.getElementById(`chk-${detailId}-${optionKey}`);
            const qty = document.getElementById(`qty-${detailId}-${optionKey}`);
            if (qty) qty.style.display = chk.checked ? 'block' : 'none';
        }
        
        addRemarkItem();
        document.getElementById('addRemarkBtn').addEventListener('click', addRemarkItem);
        function addRemarkItem() { /* Simplified */ }

        document.getElementById('generateBtn').addEventListener('click', function() {
            generateReport();
            document.getElementById('previewSection').style.display = 'block';
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
        });
        
        document.getElementById('copyBtn').addEventListener('click', function() {
            navigator.clipboard.writeText(document.getElementById('messagePreview').textContent).then(() => {
                const notification = document.getElementById('copyNotification');
                notification.style.display = 'block';
                setTimeout(() => { notification.style.display = 'none'; }, 3000);
            });
        });

        function generateReport() {
            const date = new Date(document.getElementById('reportDate').value).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const teamNames = Array.from(document.getElementById('teamName').selectedOptions)
                .map(option => option.value === 'other' ? document.getElementById('otherTeamMember').value.trim() : option.value)
                .filter(name => name).join(', ');
            const totalManpower = document.getElementById('totalManpower').value;

            let message = `*Project Report: MOH Khasab Hospital* üè•\n\n`;
            message += `üóìÔ∏è *Date:* ${date}\n`;
            if (teamNames) message += `üë• *Team:* ${teamNames}\n`;
            message += `\n*‚úÖ Work Completed Today*\n\n`;

            const locationWork = {};
            document.querySelectorAll('.work-item').forEach(item => {
                const location = item.dataset.location;
                if (!locationWork[location]) locationWork[location] = [];

                item.querySelectorAll('.work-type-checkbox:checked').forEach(checkbox => {
                    const workType = checkbox.value;
                    const sanitizedLocation = location.replace(/\s+/g, '-');
                    const detailId = `${sanitizedLocation}-${workType.replace(/\s+/g, '-')}`;
                    let subDetails = [];

                    const detailSection = document.getElementById(`detailSection-${detailId}`);
                    if (!detailSection) return;

                    if (detailSection.querySelectorAll('.sub-option-checkbox').length > 0) { // Complex types
                        detailSection.querySelectorAll('.sub-option-checkbox:checked').forEach(subChk => {
                            const optKey = subChk.dataset.subOptionKey;
                            const qtyInput = document.getElementById(`qty-${detailId}-${optKey}`);
                            const qty = qtyInput && qtyInput.value ? ` (${qtyInput.value} nos)` : '';
                            subDetails.push(`${subChk.value}${qty}`);
                        });
                    } else { // Simple types
                        const qtyInput = detailSection.querySelector('.qtyField');
                        if (qtyInput && qtyInput.value) {
                             let detailText = workType === 'Other Work' ? (detailSection.querySelector('.otherWorkInput').value || 'Other Work') : 'completed';
                             subDetails.push(`${detailText} (${qtyInput.value} nos)`);
                        } else if (qtyInput) {
                             subDetails.push('completed');
                        }
                    }

                    if (subDetails.length > 0) {
                        let workDetail = `‚Ä¢\t*${workType}:* ${subDetails.join(', ')}.`;
                        locationWork[location].push(workDetail);
                    }
                });
            });

            Object.keys(locationWork).sort().forEach(location => {
                if (locationWork[location].length > 0) {
                    message += `\tüìç *${location}*\n`;
                    locationWork[location].forEach(work => { message += `\t${work}\n`; });
                    message += '\n';
                }
            });

            if (document.getElementById('includeQuantitySwitch').checked) {
                message += `*üìä Progress Tracker (Completed/Total)*\n\n`;
                const calculateProgress = (idsAndTotals) => {
                    let completedSum = 0;
                    let totalSum = 0;
                    let sectionMessage = '';

                    idsAndTotals.forEach(item => {
                        const completedEl = document.getElementById(item.id);
                        const total = item.total;
                        if (completedEl && completedEl.value.trim() !== '') {
                            const completed = parseFloat(completedEl.value);
                            completedSum += completed;
                            totalSum += total;
                            if (!isNaN(completed) && total > 0) {
                                const percentage = Math.round((completed / total) * 100);
                                sectionMessage += `${item.label} = ${completed}/${total} *(${percentage}%)*\n`;
                            } else {
                                sectionMessage += `${item.label} = ${completedEl.value}/${total}\n`;
                            }
                        }
                    });

                    if (totalSum > 0) {
                        const overallPercentage = Math.round((completedSum / totalSum) * 100);
                        sectionMessage += `*Overall Progress:* ${completedSum}/${totalSum} *(${overallPercentage}%)*\n`;
                    }
                    return sectionMessage;
                };
                
                message += `*Access control cable pulling*\n`;
                message += calculateProgress([
                    {id: 'groundFloorComplete', total: 160, label: '1. Ground floor'},
                    {id: 'firstFloorComplete', total: 136, label: '2. First floor'},
                    {id: 'secondFloorComplete', total: 102, label: '3. Second floor'},
                ]);
                message += '\n';

                message += `*Total ACP panel installation*\n`;
                 message += calculateProgress([
                    {id: 'acpGroundFloorComplete', total: 57, label: '1. Ground floor'},
                    {id: 'acpFirstFloorComplete', total: 43, label: '2. First floor'},
                    {id: 'acpSecondFloorComplete', total: 37, label: '3. Second floor'},
                    {id: 'liftComplete', total: 10, label: '4. Lift'},
                ]);
                message += '\n';
            }

            // Remarks logic...
            
            if (totalManpower) {
                message += `\nüë∑‚Äç‚ôÇÔ∏è *Total Manpower:* ${totalManpower}`;
            }

            document.getElementById('messagePreview').textContent = message;
        }

        // Initial UI translation
        translateUI(document.getElementById('languageSelect').value);
    </script>
</body>
</html>